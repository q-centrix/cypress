<h1><%= "#{@product_test.name}" %></h1>

<% c1 = @product_test.product.c1_test %>
<% c2 = @product_test.product.c2_test %>
<% c3 = @product_test.product.c3_test %>

<% tab_label_1 = 'C1 and C3' if c1 && c3 %>
<% tab_label_1 = 'C1' if c1 && !c3 %>

<% tab_label_2 = 'C2 and C3' if c2 && c3 %>
<% tab_label_2 = 'C2' if c2 && !c3 %>

<div class = 'row '>
  <div class = 'col-sm-6'>
    <h4>Product Information</h4>
    <dl class="dl-horizontal product-information">
      <dt>Vendor</dt>
      <dd><%= @product_test.product.vendor.name %></dd>
      <dt>Product</dt>
      <dd><%= @product_test.product.name %></dd>
      <% unless @product_test.product.version.blank? %>
      <dt>Version:</dt>
      <dd><%= @product_test.product.version %></dd>
      <% end %>
    </dl>

    <div class="well well-sm test-step">
      <h2>[1] Download Test Deck</h2>
      <%= form_for @product_test, url: {action: 'download'}, :html => { :method => 'GET' } do |f| %>
        <%= button_tag(type: 'submit', class: 'btn btn-info btn-block') do %>
          <i class = 'fa fa-fw fa-download'></i> Download CAT 1 (.zip)
        <% end %>
      <% end %>
    </div>
  </div>

  <div class = 'col-sm-6'>
    <h4 class = 'pull-left'>Current Test Status</h4>
    <button class = 'btn btn-primary pull-right'>
      <i class = 'fa fa-fw fa-download'></i> Download Full Report
    </button>
    <table class = 'table table-sm small-table'>
      <thead>
        <tr>
          <td></td>
          <th colspan = '2'>CAT 1 Testing</th>
          <th colspan = '2'>CAT 3 Testing</th>
        </tr>
        <tr>
          <td></td>
          <th>C1</th>
          <th>C3</th>
          <th>C2</th>
          <th>C3</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <th>Warnings:</th>
          <td>0</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
        </tr>
        <tr>
          <th>Errors:</th>
          <td>0</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<div class="measure-test-tabs">
  <% if c1 && c2 %>
    <ul>
      <li><a href="#cat1"><%= "CAT 1 (#{tab_label_1})" %></a></li>
      <li><a href="#cat3"><%= "CAT 3 (#{tab_label_2})" %></a></li>
    </ul>
  <% end %>

  <% if c1 %>
    <% if c1 && c2 %>
      <div id = 'cat1'>
    <% end %>

        <div class="well well-sm test-step">
          <h2><%= "[2] Upload for #{tab_label_1}" %></h2>
          <p class = 'description'>
            <%= "Upload your CAT 1 zip file to get test results for #{tab_label_1} certifications. This will automatically run a test execution." %></p>

          <%= form_for(TestExecution.new, :html => {method: :post, :multipart => true}) do |f| %>
            <%= hidden_field_tag :task_id, @product_test.c1_task.id %>
            <div class="fileinput fileinput-new input-group" data-provides="fileinput">
              <div class="form-control" data-trigger="fileinput"><i class="fa fa-fw fa-file fileinput-exists"></i> <span class="fileinput-filename"></span></div>
              <span class="input-group-btn btn-file">
                <span class="fileinput-new"><button class="btn btn-info" type="button"><i class="fa fa-fw fa-mouse-pointer"></i> Select file</button></span>
                <span class="fileinput-exists"><button class="btn btn-warning" type="button"><i class="fa fa-fw fa-refresh"></i> Change</button></span>
                <span class="fileinput-exists"><button class="btn btn-info" type="submit"><i class="fa fa-fw fa-upload"></i> Upload and run test</button></span>
                <%= file_field_tag :results %>
              </span>
            </div>
          <% end %>
        </div>

        <hr>
        <h2 class="test-result">CAT 1 Test Results for <%= "#{@product_test.name}" %></h2>
        <p class = 'description'>Here is where the results are going to be. There is nothing here right now. Deal with it.</p>
        <% # c1 and c2 are set to true and false respectively because we only want to display errors for c1 (and c3 if desired) %>
        <%= render partial: "test_execution_results", locals: { product_test: @product_test, c1: true, c2: false, c3: c3 } %>

    <% if c1 && c2 %>
      </div>
    <% end %>
  <% end %>
  <% if c2 %>
    <% if c1 && c2 %>
      <div id = 'cat3'>
    <% end %>
        <div class="well well-sm test-step">
          <h2><%= "[2] Upload for #{tab_label_2}" %></h2>
          <p class = 'description'>
            <%= "Upload your CAT 3 zip file to get test results for #{tab_label_2} certifications. This will automatically run a test execution." %></p>
          <%= form_for(TestExecution.new, :html => {method: :post, :multipart => true}) do |f| %>
            <%= hidden_field_tag :task_id, @product_test.c2_task.id %>
            <div class="fileinput fileinput-new input-group" data-provides="fileinput">
              <div class="form-control" data-trigger="fileinput"><i class="fa fa-fw fa-file fileinput-exists"></i> <span class="fileinput-filename"></span></div>
              <span class="input-group-btn btn-file">
                <span class="fileinput-new"><button class="btn btn-info" type="button"><i class="fa fa-fw fa-mouse-pointer"></i> Select file</button></span>
                <span class="fileinput-exists"><button class="btn btn-warning" type="button"><i class="fa fa-fw fa-refresh"></i> Change</button></span>
                <span class="fileinput-exists"><button class="btn btn-info" type="submit"><i class="fa fa-fw fa-upload"></i> Upload and run test</button></span>
                <%= file_field_tag :results %>
              </span>
            </div>
          <% end %>
        </div>

        <hr>
        <h2 class="test-result">CAT 3 Test Results for <%= "#{@product_test.name}" %></h2>
        <p class = 'description'>Here is where the results are going to be. There is nothing here right now. Deal with it.</p>
        <% # c1 and c2 are set to false and true respectively because we only want to display errors for c2 (and c3 if desired) %>
        <%= render partial: "test_execution_results", locals: { product_test: @product_test, c1: false, c2: true, c3: c3 } %>

    <% if c1 && c2 %>
      </div>
    <% end %>
  <% end %>
</div>
